{"version":3,"file":"WeakMap.js","sourceRoot":"","sources":["WeakMap.ts"],"names":["Shim","Shim.getUID","generateName","Shim.WeakMap","Shim.WeakMap.constructor","Shim.WeakMap.delete","Shim.WeakMap.get","Shim.WeakMap.has","Shim.WeakMap.set","WeakMap","WeakMap.constructor","WeakMap.delete","WeakMap.get","WeakMap.has","WeakMap.set"],"mappings":"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","sourcesContent":["import { hasClass } from './decorators';\nimport global from './global';\n\nmodule Shim {\n\tconst DELETED: any = {};\n\n\tinterface Entry<K, V> {\n\t\tkey: K;\n\t\tvalue: V;\n\t}\n\n\tfunction getUID(): number {\n\t\treturn Math.floor(Math.random() * 100000000);\n\t}\n\n\tlet generateName = (function () {\n\t\tlet startId = Math.floor(Date.now() % 100000000);\n\n\t\treturn function generateName(): string {\n\t\t\treturn '__wm' + getUID() + (startId++ + '__');\n\t\t};\n\t})();\n\n\texport class WeakMap<K, V> {\n\t\tprivate _name: string;\n\n\t\tconstructor(iterable?: any) {\n\t\t\tObject.defineProperty(this, '_name', {\n\t\t\t\tvalue: generateName()\n\t\t\t});\n\t\t\tif (iterable) {\n\t\t\t\tfor (const [ key, value ] of iterable) {\n\t\t\t\t\tthis.set(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete(key: any): boolean {\n\t\t\tconst entry: Entry<K, V> = key[this._name];\n\t\t\tif (entry && entry.key === key && entry.value !== DELETED) {\n\t\t\t\tentry.value = DELETED;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tget(key: any): V {\n\t\t\tconst entry: Entry<K, V> = key[this._name];\n\t\t\tif (entry && entry.key === key && entry.value !== DELETED) {\n\t\t\t\treturn entry.value;\n\t\t\t}\n\t\t}\n\n\t\thas(key: any): boolean {\n\t\t\tconst entry: Entry<K, V> = key[this._name];\n\t\t\treturn Boolean(entry && entry.key === key && entry.value !== DELETED);\n\t\t}\n\n\t\tset(key: any, value?: any): Shim.WeakMap<K, V> {\n\t\t\tif (!key || (typeof key !== 'object' && typeof key !== 'function')) {\n\t\t\t\tthrow new TypeError('Invalid value used as weak map key');\n\t\t\t}\n\t\t\tlet entry: Entry<K, V> = key[this._name];\n\t\t\tif (!entry || entry.key !== key) {\n\t\t\t\tentry = Object.create(null, {\n\t\t\t\t\tkey: { value: key }\n\t\t\t\t});\n\t\t\t\tObject.defineProperty(key, this._name, {\n\t\t\t\t\tvalue: entry\n\t\t\t\t});\n\t\t\t}\n\t\t\tentry.value = value;\n\t\t\treturn this;\n\t\t}\n\t}\n}\n\n@hasClass('weakmap', global.WeakMap, Shim.WeakMap)\nexport default class WeakMap<K, V> {\n\t/* istanbul ignore next */\n\tconstructor(iterable?: any) {}\n\n\t/* istanbul ignore next */\n\tdelete(key: K): boolean { throw new Error(); }\n\t/* istanbul ignore next */\n\tget(key: K): V { throw new Error(); }\n\t/* istanbul ignore next */\n\thas(key: K): boolean { throw new Error(); }\n\t/* istanbul ignore next */\n\tset(key: K, value?: V): WeakMap<K, V> { throw new Error(); }\n}\n"]}